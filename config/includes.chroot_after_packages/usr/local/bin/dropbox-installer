#!/bin/bash
echo ""
read -p "   [0;32mDropbox Installer[0m

   This script will download and install Dropbox. Securely store, 
   organize, and share all of your files.
   
   A web browser is recommended for dropbox initialization.
   
   [0;33mhttps://www.dropbox.com/[0m
   
   After installation, start dropbox from: 
   [0;32mMenu --> All Programs --> Internet[0m
   
   Warning* - Do not use dropbox and Maestral at the same time!
   
  [0;32m----------------------------------------
   
   Please press enter to install Dropbox.
   
  ----------------------------------------[0m
      
   Or close this terminal window to quit the install." ;
echo ""
full_fs=$(df ~ | tail -1 | awk '{print $1;}')  # find partition
fs=$(basename "$full_fs")
### Check for internet connection
   if : >/dev/tcp/8.8.8.8/53; then  
### Find out if in Live environment and quit if so.
if ! grep -q "$fs" /proc/partitions; then
 echo "   [0;32m-------------------------------------------------------"
 echo ""
 echo "   Dropbox cannot be installed in a live environment."
 echo "   Install and try again!"
 echo ""
 echo "   -------------------------------------------------------[0m"
 echo ""
else
### Remove old configs
rm -fr ~/.local/share/.dropbox-dist
rm -fr ~/.dropbox
### This will set thunar as the default manager
xdg-mime default thunar.desktop inode/directory
### Install dependencies
sudo apt update
sudo apt-get install -y wget python3-gpg
cd ~/.local/share || exit
### Grab dropbox.py for terminl use
sudo wget -O /usr/local/bin/dropbox "https://www.dropbox.com/download?dl=packages/dropbox.py" &&
sudo chmod +x /usr/local/bin/dropbox
### Grab dropbox
wget -O - "https://www.dropbox.com/download?plat=lnx.x86_64" | tar xzf - &&
echo ""
echo "  [0;32m----------------------------------------------------------------------"
echo ""
echo "   Start dropbox from: Menu --> All Programs --> Internet"
echo ""
echo "   Look in the system tray for the Dropbox icon for options"
echo ""  
echo "   Type 'dropbox' in a terminal to see all the commands."
echo ""
echo "  ----------------------------------------------------------------------[0m"
echo ""
echo "   [0;32mStarting Dropbox ... Please wait.[0m"
echo ""
### Initial start of dropbox
nohup ".dropbox-dist/dropboxd" > file 2>&1 &
if ! test -e /usr/share/applications/dropbox.desktop; then
sudo touch /usr/share/applications/dropbox.desktop
{
echo "[Desktop Entry]"
echo "Type=Application"
echo "Name=Dropbox"
echo "Exec=sh -c ~/.local/share/.dropbox-dist/dropboxd"
echo "StartupNotify=false"
echo "Terminal=false"
echo "Icon=web-browser"
echo "Categories=Network;";} | sudo tee -a /usr/share/applications/dropbox.desktop > /dev/null
fi
sleep 8
fi
else
echo ""
 echo "   [0;31m-------------------------------------------------------"
 echo ""
 echo "   No Internet connection. Please connect and try again."
 echo ""
 echo "   -------------------------------------------------------[0m"
echo ""
fi
